<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title>관리자 대시보드</title>
    <link rel="stylesheet" th:href="@{/css/admin.css}" layout:fragment="styles">
</head>
<body>
<section layout:fragment="content" class="admin-dashboard">
    <div class="page-header">
        <h2>관리자 대시보드</h2>
        <p>사이트 이용 현황과 접속 통계를 한눈에 확인하세요.</p>
    </div>

    <div class="stat-grid">
        <div class="stat-card">
            <h3>전체 사용자</h3>
            <p class="stat-value" th:text="${dashboard.totalUsers}">0</p>
        </div>
        <div class="stat-card">
            <h3>관리자</h3>
            <p class="stat-value" th:text="${dashboard.adminUsers}">0</p>
        </div>
        <div class="stat-card">
            <h3>일반 사용자</h3>
            <p class="stat-value" th:text="${dashboard.regularUsers}">0</p>
        </div>
        <div class="stat-card">
            <h3>총 접속 횟수</h3>
            <p class="stat-value" th:text="${dashboard.totalLoginCount}">0</p>
        </div>
        <div class="stat-card">
            <h3>평균 접속 횟수</h3>
            <p class="stat-value" th:text="${#numbers.formatDecimal(dashboard.averageLoginPerUser, 1, 2)}">0.0</p>
        </div>
        <div class="stat-card">
            <h3>현재 접속 중</h3>
            <p class="stat-value" th:text="${dashboard.activeUserCount}">0</p>
        </div>
    </div>

    <div class="data-sections">
        <section class="data-card">
            <div class="data-card__header">
                <h3>실시간 접속 현황</h3>
                <span class="data-card__caption"
                      th:text="${'마지막 업데이트: ' + #temporals.format(#temporals.createNow(), 'yyyy-MM-dd HH:mm:ss')}"></span>
            </div>
            <div class="table-wrapper">
                <table>
                    <thead>
                    <tr>
                        <th>사용자명</th>
                        <th>권한</th>
                        <th>로그인 시각</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:if="${#lists.isEmpty(dashboard.activeUsers)}">
                        <td colspan="3" class="empty">현재 접속 중인 사용자가 없습니다.</td>
                    </tr>
                    <tr th:each="active : ${dashboard.activeUsers}">
                        <td th:text="${active.username()}">user</td>
                        <td>
                            <span class="badge" th:text="${active.role()}">USER</span>
                        </td>
                        <td th:text="${#temporals.format(active.loggedInAt(), 'yyyy-MM-dd HH:mm:ss')}">2024-01-01 12:00:00</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <section class="data-card">
            <div class="data-card__header">
                <h3>최근 접속 사용자</h3>
                <span class="data-card__caption">최근 로그인 순</span>
            </div>
            <div class="table-wrapper">
                <table>
                    <thead>
                    <tr>
                        <th>사용자명</th>
                        <th>권한</th>
                        <th>마지막 로그인</th>
                        <th>누적 접속 수</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:if="${#lists.isEmpty(dashboard.recentLogins)}">
                        <td colspan="4" class="empty">아직 로그인 기록이 없습니다.</td>
                    </tr>
                    <tr th:each="user : ${dashboard.recentLogins}">
                        <td th:text="${user.username()}">user</td>
                        <td><span class="badge" th:text="${user.role()}">USER</span></td>
                        <td th:text="${user.lastLoginAt() != null ? #temporals.format(user.lastLoginAt(), 'yyyy-MM-dd HH:mm:ss') : '기록 없음'}">기록 없음</td>
                        <td th:text="${user.loginCount()}">0</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </div>
</section>
</body>
</html>
